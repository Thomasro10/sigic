$.validator.setDefaults({
    errorElement: 'span', //default input error message container
    errorClass: 'help-block help-block-error', // default input error message class
    focusInvalid: true, // do not focus the last invalid input
    ignore: "",
    errorPlacement: function(error, element) {
        if (element.is(':checkbox')) {
            error.insertAfter(element.closest(".md-checkbox-list, .md-checkbox-inline, .checkbox-list, .checkbox-inline"));
        } else if (element.is(':radio')) {
            error.insertAfter(element.closest(".md-radio-list, .md-radio-inline, .radio-list,.radio-inline"));
        } else {
            error.insertAfter(element); // for other inputs, just perform default behavior
        }
    },
    highlight: function(element) { // hightlight error inputs
        $(element).closest('.form-group').addClass('has-error'); // set error class to the control group
    },
    unhighlight: function(element) { // revert the change done by hightlight
        $(element).closest('.form-group').removeClass('has-error'); // set error class to the control group
    },
    success: function(label) {
        label.closest('.form-group').removeClass('has-error'); // set success class to the control group
    }
});

$(document).ajaxStart(function() {
    $(".env-loader").show();
}).ajaxStop(function() {
    $(".env-loader").hide();
});

$.ajaxSetup({
    headers: {
        'X-CSRF-Token': $('meta[name="_token"]').attr('content')
    }
});

facceso = $('#acceso-sigic');
facceso.validate({});

function onSubmitForm(event) {
    grecaptcha.execute();
    event.preventDefault();
}

function recaptchaOnSubmit(token) {
    if(facceso.valid()){
        $.ajax({
            url: facceso.data('accion'),
            method: 'POST',
            data: facceso.serialize(),
            // This causes Accepts header to be application/json
            dataType: "json",
            success: function(data) {
                if (data.status == 1) {
                    location.href=$("#acceso-sigic").data('index');
                }
                else {
                    grecaptcha.reset();
                    swal(data.msg, "", "error");
                }
            }
        });
    }

}



var Login = function() {

    var handleLogin = function() {

        $('#acceso-sigic').on('submit', onSubmitForm);
        /* $('#acceso-sigic').validate({
            ignore: ".ignore",
            rules: {
                'g-recaptcha-response': {
                    required: function () {
                        if (grecaptcha.getResponse() == '') {
                            return true;
                        } else {
                            return false;
                        }
                    }
                }
            },
            messages: {
                "g-recaptcha-response": "Prueba que eres HUMANO"
            },
            submitHandler: function(form){
                alert(window.grecaptcha.getResponse())
                    $.ajax({
                        type: "POST",
                        url: $("#acceso-sigic").data('accion'),
                        data: $('#acceso-sigic').serialize(),
                        success: function( data ) {
                            if (data.status == 1) {
                                location.href=$("#acceso-sigic").data('index');
                            }
                            else {
                                grecaptcha.reset();
                                swal(data.msg, "", "error");
                            }
                        }
                    });
            }
        });*/

    }

       /* $('.login-form input').keypress(function(e) {
            if (e.which == 13) {
                if ($('.login-form').validate().form()) {
                    $('.login-form').submit(); //form validation success, call ajax form submit
                }
                return false;
            }
        });

        $('.forget-form input').keypress(function(e) {
            if (e.which == 13) {
                if ($('.forget-form').validate().form()) {
                    $('.forget-form').submit();
                }
                return false;
            }
        });

        $('#forget-password').click(function(){
            $('.login-form').hide();
            $('.forget-form').show();
        });

        $('#back-btn').click(function(){
            $('.login-form').show();
            $('.forget-form').hide();
        });
    }*/

    return {
        //main function to initiate the module
        init: function() {

            handleLogin();

            // init background slide images
            $('.login-bg').backstretch([
                    $('#login-url').val()+"/assets/pages/img/login/bg1.jpg",
                    $('#login-url').val()+"/assets/pages/img/login/bg2.jpg",
                    $('#login-url').val()+"/assets/pages/img/login/bg3.jpg",
                    $('#login-url').val()+"/assets/pages/img/login/bg4.jpg"
                ], {
                    fade: 1000,
                    duration: 8000
                }
            );

            $('.forget-form').hide();

        }

    };

}();


jQuery(document).ready(function() {
    $(".env-loader").show();
    Login.init();
});

$(window).load(function () {
    setTimeout(function () {
        $(".env-loader").hide();
    }, 200);
});